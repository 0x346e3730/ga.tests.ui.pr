name: Testing PrestaShop pull requests
on:
  workflow_dispatch:
    inputs:
      pr_number:
        description: Pull request to test
        required: true
      base_branch:
        description: Base branch to rebase the PR
        required: true
        default: 'develop'
      php_version:
        description: PHP version
        required: true
        default: '7.3'

jobs:
  testing-pr:
    runs-on: ubuntu-latest
    name: test
    strategy:
      fail-fast: false
      matrix:
        TEST_COMMAND:
          - 'functional:BO:login'

    env:
      PR_NUMBER: ${{ github.event.inputs.pr_number }}
      BASE_BRANCH: ${{ github.event.inputs.base_branch }}
      PHP_VERSION: ${{ github.event.inputs.php_version }}
      PS_DIR: 'my_prestashop'

    steps:
      - uses: actions/checkout@v2
        with:
          path: main

      - uses: actions/checkout@v2
        name: Checkout PrestaShop repository
        with:
          fetch-depth: 2
          repository: PrestaShop/PrestaShop
          path: ${{ env.PS_DIR }}

      - name: Get pull request
        run: |
          git fetch origin pull/${{ env.PR_NUMBER }}/head:pr${{ env.PR_NUMBER }}
          git checkout pr${{ env.PR_NUMBER }}
        working-directory: ${{ env.PS_DIR }}

      - run: ls ${{ github.workspace }}
      - run: ls ${{ github.workspace }}/main/
      - run: ls ${{ github.workspace }}/${{ env.PS_DIR }}/
